<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion to WordPress å…¼å®¹æ€§æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 10px;
        }
        .console-output {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Notion to WordPress å…¼å®¹æ€§æµ‹è¯•é¡µé¢</h1>
    
    <div class="console-output">
        <strong>ğŸ“‹ æµ‹è¯•è¯´æ˜ï¼š</strong><br>
        1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°<br>
        2. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºä¿¡æ¯<br>
        3. æ£€æŸ¥æ•°å­¦å…¬å¼å’Œå›¾è¡¨æ˜¯å¦æ­£ç¡®æ˜¾ç¤º<br>
        4. éªŒè¯å¤‡ç”¨æœºåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“ KaTeX æ•°å­¦å…¬å¼æµ‹è¯•</h2>
        
        <h3>è¡Œå†…å…¬å¼æµ‹è¯•ï¼š</h3>
        <p>çˆ±å› æ–¯å¦è´¨èƒ½æ–¹ç¨‹ï¼š<span class="notion-equation-inline">$E = mc^2$</span></p>
        <p>å‹¾è‚¡å®šç†ï¼š<span class="notion-equation-inline">$a^2 + b^2 = c^2$</span></p>
        
        <h3>å—çº§å…¬å¼æµ‹è¯•ï¼š</h3>
        <div class="notion-equation-block">$$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$</div>
        
        <div class="notion-equation-block">$$\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}$$</div>
        
        <h3>åŒ–å­¦å…¬å¼æµ‹è¯•ï¼š</h3>
        <p>æ°´åˆ†å­ï¼š<span class="notion-equation-inline">$ce{H2O}$</span></p>
        <p>ç¢³é…¸é’™ï¼š<span class="notion-equation-inline">$ce{CaCO3}$</span></p>
        <div class="notion-equation-block">$$ce{2H2 + O2 -> 2H2O}$$</div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“Š Mermaid å›¾è¡¨æµ‹è¯•</h2>
        
        <h3>æµç¨‹å›¾æµ‹è¯•ï¼š</h3>
        <div class="mermaid">
graph TD
    A[å¼€å§‹] --> B{æ£€æµ‹CDN}
    B -->|æˆåŠŸ| C[ä½¿ç”¨CDNèµ„æº]
    B -->|å¤±è´¥| D[åˆ‡æ¢æœ¬åœ°å¤‡ç”¨]
    C --> E[æ¸²æŸ“å®Œæˆ]
    D --> E
        </div>
        
        <h3>åºåˆ—å›¾æµ‹è¯•ï¼š</h3>
        <div class="mermaid">
sequenceDiagram
    participant U as ç”¨æˆ·
    participant P as æ’ä»¶
    participant C as CDN
    participant L as æœ¬åœ°å¤‡ç”¨
    
    U->>P: åŠ è½½é¡µé¢
    P->>C: è¯·æ±‚èµ„æº
    C-->>P: åŠ è½½å¤±è´¥
    P->>L: åˆ‡æ¢å¤‡ç”¨èµ„æº
    L-->>P: åŠ è½½æˆåŠŸ
    P->>U: æ˜¾ç¤ºå†…å®¹
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ”§ CDNå¤±è´¥æ¨¡æ‹Ÿæµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æ¨¡æ‹ŸCDNå¤±è´¥åœºæ™¯ï¼š</p>
        <button onclick="simulateCDNFailure()">æ¨¡æ‹ŸCDNå¤±è´¥</button>
        <button onclick="testFallbackMechanism()">æµ‹è¯•å¤‡ç”¨æœºåˆ¶</button>
        <div id="test-results"></div>
    </div>

    <!-- æ¨¡æ‹ŸjQuery -->
    <script>
        // ç®€å•çš„jQueryæ¨¡æ‹Ÿï¼Œç”¨äºæµ‹è¯•
        window.$ = function(selector) {
            return {
                each: function(callback) {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(callback);
                    return this;
                },
                html: function(content) {
                    if (content !== undefined) {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(el => el.innerHTML = content);
                        return this;
                    } else {
                        const element = document.querySelector(selector);
                        return element ? element.innerHTML : '';
                    }
                }
            };
        };
        
        // æ¨¡æ‹ŸWordPressç¯å¢ƒ
        window.jQuery = window.$;
        
        // æµ‹è¯•å‡½æ•°
        function simulateCDNFailure() {
            console.log('ğŸ§ª [æµ‹è¯•] æ¨¡æ‹ŸCDNå¤±è´¥åœºæ™¯...');
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„KaTeXå’ŒMermaid
            delete window.katex;
            delete window.mermaid;
            
            // é‡æ–°åŠ è½½è„šæœ¬æ¥è§¦å‘æ£€æµ‹
            setTimeout(() => {
                console.log('ğŸ§ª [æµ‹è¯•] é‡æ–°åˆå§‹åŒ–æ¸²æŸ“...');
                if (typeof renderAllKatex === 'function') {
                    renderAllKatex();
                }
                if (typeof initMermaid === 'function') {
                    initMermaid();
                }
            }, 100);
        }
        
        function testFallbackMechanism() {
            console.log('ğŸ§ª [æµ‹è¯•] æµ‹è¯•å¤‡ç”¨æœºåˆ¶...');
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>æ­£åœ¨æµ‹è¯•å¤‡ç”¨æœºåˆ¶ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º...</p>';
            
            // æ£€æŸ¥å¤‡ç”¨æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            const testPaths = [
                'assets/vendor/katex/katex.min.css',
                'assets/vendor/katex/katex.min.js',
                'assets/vendor/mermaid/mermaid.min.js'
            ];
            
            testPaths.forEach(path => {
                fetch(path)
                    .then(response => {
                        if (response.ok) {
                            console.log('âœ… [æµ‹è¯•] å¤‡ç”¨æ–‡ä»¶å­˜åœ¨:', path);
                        } else {
                            console.error('âŒ [æµ‹è¯•] å¤‡ç”¨æ–‡ä»¶ä¸å­˜åœ¨:', path);
                        }
                    })
                    .catch(error => {
                        console.error('âŒ [æµ‹è¯•] æ— æ³•è®¿é—®å¤‡ç”¨æ–‡ä»¶:', path, error);
                    });
            });
        }
    </script>

    <!-- åŠ è½½æˆ‘ä»¬çš„æ”¹è¿›åçš„è„šæœ¬ -->
    <script src="assets/js/katex-mermaid.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåçš„æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª [æµ‹è¯•] é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹å…¼å®¹æ€§æµ‹è¯•...');
            
            // æ£€æŸ¥è„šæœ¬æ˜¯å¦æ­£ç¡®åŠ è½½
            setTimeout(() => {
                console.log('ğŸ§ª [æµ‹è¯•] æ£€æŸ¥å‡½æ•°æ˜¯å¦å®šä¹‰:');
                console.log('  - checkKatexLoaded:', typeof checkKatexLoaded);
                console.log('  - checkMermaidLoaded:', typeof checkMermaidLoaded);
                console.log('  - ResourceFallbackManager:', typeof ResourceFallbackManager);
                console.log('  - renderAllKatex:', typeof renderAllKatex);
                console.log('  - initMermaid:', typeof initMermaid);
            }, 500);
        });
    </script>
</body>
</html>
