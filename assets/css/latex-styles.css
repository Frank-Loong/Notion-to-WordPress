/**
 * LaTeX 数学公式样式
 * 为使用 KaTeX 渲染的 LaTeX 数学公式提供样式，确保在不同设备上正确显示。
 * @since      1.0.7
 * @version    2.0.0-beta.1
 * @package    Notion_To_WordPress
 * @author     Frank-Loong
 * @license    GPL-3.0-or-later
 * @link       https://github.com/Frank-Loong/Notion-to-WordPress
 */

/* 块级公式样式 */
.latex-block {
    display: block;
    margin: 1.5em 0;
    text-align: center;
    overflow-x: auto;
    max-width: 100%;
}

/* 行内公式样式 */
.latex-inline {
    display: inline-block;
    vertical-align: middle;
    margin: 0 0.2em;
}

/* Notion公式样式 */
.notion-equation-inline {
    display: inline-block;
    vertical-align: middle;
    margin: 0 0.2em;
}

.notion-equation-block {
    display: block;
    margin: 1.5em 0;
    text-align: center;
    overflow-x: auto;
    max-width: 100%;
}

/* KaTeX相关样式调整 */
.katex {
    outline: 0;
    font-size: 1.1em;
}

.katex-display {
    display: block;
    text-align: center;
    margin: 1em 0;
    padding: 0.5em 0;
    overflow-x: auto;
    overflow-y: hidden;
    max-width: 100%;
}

.katex-display > .katex {
    display: inline-block;
    white-space: nowrap;
}

/* 修复KaTeX标签重叠问题并优化样式 */
.katex-display .tag {
    position: absolute;
    right: 0.5em;
    top: 50%;
    transform: translateY(-50%);
    white-space: nowrap;
    z-index: 1;

    /* 优雅的标签样式 */
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 8px !important;
    padding: 0.4em 0.8em !important;
    font-size: 0.85em !important;
    color: #495057 !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    font-weight: 500 !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    transition: all 0.3s ease !important;
}

.katex-display .tag:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%) !important;
    border-color: #adb5bd !important;
    color: #212529 !important;
    transform: translateY(-50%) scale(1.05) !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
}

/* 标签内部元素样式重置 */
.katex-display .tag .strut {
    display: none !important; /* 隐藏KaTeX的strut元素 */
}

.katex-display .tag .mord {
    color: inherit !important;
    font-family: inherit !important;
    font-size: inherit !important;
}

.katex-display .tag .mord.text {
    font-family: inherit !important;
}

/* 对于不支持:has()的浏览器，使用通用样式 */
.katex-display {
    position: relative !important;
    padding-right: 6em;
}

/* 确保公式内容不会与标签重叠 */
.katex-display .katex-html {
    max-width: calc(100% - 8em);
    display: inline-block;
}

/* 响应式设计 - 小屏幕上的标签处理 */
@media (max-width: 768px) {
    .katex-display {
        padding-right: 3em;
    }

    .katex-display .tag {
        font-size: 0.75em !important;
        padding: 0.3em 0.5em !important;
        right: 0.2em;
    }

    .katex-display .katex-html {
        max-width: calc(100% - 3.5em);
    }
}

/* KaTeX错误样式 */
.katex-error {
    color: #d32f2f;
    background-color: #ffebee;
    border: 1px solid #ffcdd2;
    border-radius: 4px;
    padding: 0.2em 0.4em;
    font-family: monospace;
    font-size: 0.9em;
    display: inline-block;
    margin: 0.1em;
}

/* 确保图表和公式正常显示 */
.mermaid {
    margin: 2em 0;
    text-align: center;
    overflow-x: auto;
    max-width: 100%;
    padding: 1em;
    background: #f9f9f9;
    border-radius: 5px;
}

/* 暗色主题适配 */
@media (prefers-color-scheme: dark) {
    .katex {
        color: #f0f0f0;
    }

    .katex-display {
        color: #f0f0f0;
    }

    .katex-error {
        color: #f44336;
        background-color: #3d2f2f;
        border-color: #5d4037;
    }

    .mermaid {
        background: #2d2d2d;
        color: #f0f0f0;
    }
}

/* 媒体查询适配移动设备 */
@media (max-width: 768px) {
    .katex {
        font-size: 95% !important;
    }

    .katex-display {
        font-size: 95% !important;
        margin: 0.8em 0;
        padding: 0.3em 0;
    }

    .notion-equation-block {
        margin: 1em 0;
        font-size: 95%;
    }

    .mermaid {
        font-size: 90%;
    }
}