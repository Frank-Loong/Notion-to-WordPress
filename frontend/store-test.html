<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoreåŠŸèƒ½éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .test-section h2 {
            margin-top: 0;
            color: #555;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-passed {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-failed {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .run-button {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .run-button:hover {
            background-color: #0056b3;
        }
        .run-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .instructions {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Zustand Store åŠŸèƒ½éªŒè¯æµ‹è¯•</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>æ­¤é¡µé¢ç”¨äºéªŒè¯æ–°å®ç°çš„ZustandçŠ¶æ€ç®¡ç†æ¶æ„çš„åŸºæœ¬åŠŸèƒ½ã€‚æµ‹è¯•åŒ…æ‹¬ï¼š</p>
            <ul>
                <li><strong>SyncStore</strong>: åŒæ­¥çŠ¶æ€ç®¡ç†ã€è¿›åº¦æ›´æ–°ã€é”™è¯¯å¤„ç†</li>
                <li><strong>SettingsStore</strong>: è®¾ç½®ç®¡ç†ã€å­—æ®µéªŒè¯ã€è¿æ¥æµ‹è¯•</li>
                <li><strong>UIStore</strong>: UIçŠ¶æ€ã€é€šçŸ¥ç³»ç»Ÿã€ä¸»é¢˜åˆ‡æ¢</li>
                <li><strong>å¤åˆåŠŸèƒ½</strong>: è·¨storeæ“ä½œã€åº”ç”¨åˆå§‹åŒ–ã€çŠ¶æ€é‡ç½®</li>
            </ul>
        </div>

        <button id="runTest" class="run-button">ğŸš€ è¿è¡ŒStoreéªŒè¯æµ‹è¯•</button>
        
        <div id="testResults"></div>
        
        <div class="instructions">
            <h3>ğŸ”§ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤</h3>
            <p>å¦‚æœè‡ªåŠ¨æµ‹è¯•æ— æ³•è¿è¡Œï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
            <div class="code-block">
// 1. æµ‹è¯•SyncStoreåŸºæœ¬åŠŸèƒ½<br>
const syncStore = window.useSyncStore?.getState();<br>
console.log('SyncStoreåˆå§‹çŠ¶æ€:', syncStore);<br>
<br>
// 2. æµ‹è¯•SettingsStoreåŸºæœ¬åŠŸèƒ½<br>
const settingsStore = window.useSettingsStore?.getState();<br>
console.log('SettingsStoreåˆå§‹çŠ¶æ€:', settingsStore);<br>
<br>
// 3. æµ‹è¯•UIStoreåŸºæœ¬åŠŸèƒ½<br>
const uiStore = window.useUIStore?.getState();<br>
console.log('UIStoreåˆå§‹çŠ¶æ€:', uiStore);<br>
<br>
// 4. è¿è¡Œå®Œæ•´éªŒè¯<br>
if (window.runStoreValidation) {<br>
&nbsp;&nbsp;window.runStoreValidation();<br>
} else {<br>
&nbsp;&nbsp;console.log('éªŒè¯å‡½æ•°æœªåŠ è½½');<br>
}
            </div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿå¯¼å…¥storeï¼ˆå®é™…é¡¹ç›®ä¸­ä¼šé€šè¿‡æ„å»ºå·¥å…·å¤„ç†ï¼‰
        let storesLoaded = false;
        let validationFunction = null;

        // å°è¯•åŠ è½½stores
        async function loadStores() {
            try {
                // è¿™é‡Œéœ€è¦å®é™…çš„æ„å»ºè¾“å‡ºæˆ–è€…å¼€å‘æœåŠ¡å™¨
                console.log('âš ï¸ æ³¨æ„: æ­¤æµ‹è¯•é¡µé¢éœ€è¦åœ¨Viteå¼€å‘æœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œ');
                console.log('è¯·è¿è¡Œ: npm run dev ç„¶åè®¿é—® http://localhost:5173/store-test.html');
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒä¸­
                if (window.location.protocol === 'file:') {
                    throw new Error('è¯·åœ¨HTTPæœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œæ­¤æµ‹è¯•');
                }
                
                // å°è¯•åŠ¨æ€å¯¼å…¥
                const { runStoreValidation } = await import('./src/stores/__test__/store-validation.ts');
                validationFunction = runStoreValidation;
                storesLoaded = true;
                
                document.getElementById('testResults').innerHTML = `
                    <div class="success">
                        âœ… Storeæ¨¡å—åŠ è½½æˆåŠŸï¼å¯ä»¥å¼€å§‹æµ‹è¯•ã€‚
                    </div>
                `;
                
            } catch (error) {
                console.error('åŠ è½½storeså¤±è´¥:', error);
                document.getElementById('testResults').innerHTML = `
                    <div class="error">
                        <h3>âŒ æ— æ³•åŠ è½½Storeæ¨¡å—</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                        <ol>
                            <li>ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ <code>cd frontend && npm run dev</code></li>
                            <li>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:5173/store-test.html</code></li>
                            <li>æˆ–è€…åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰‹åŠ¨æµ‹è¯•ï¼ˆå‚è€ƒä¸‹æ–¹è¯´æ˜ï¼‰</li>
                        </ol>
                    </div>
                `;
            }
        }

        // è¿è¡Œæµ‹è¯•
        async function runTests() {
            const button = document.getElementById('runTest');
            const resultsDiv = document.getElementById('testResults');
            
            button.disabled = true;
            button.textContent = 'ğŸ”„ è¿è¡Œä¸­...';
            
            resultsDiv.innerHTML = '<div class="loading">æ­£åœ¨è¿è¡Œæµ‹è¯•...</div>';
            
            try {
                if (!storesLoaded || !validationFunction) {
                    throw new Error('Storeæ¨¡å—æœªæ­£ç¡®åŠ è½½');
                }
                
                const results = validationFunction();
                
                let html = '<h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>';
                
                results.forEach(result => {
                    const statusClass = result.overallPassed ? 'test-passed' : 'test-failed';
                    const statusIcon = result.overallPassed ? 'âœ…' : 'âŒ';
                    
                    html += `
                        <div class="test-section">
                            <h3>${statusIcon} ${result.storeName}</h3>
                    `;
                    
                    result.tests.forEach(test => {
                        const testClass = test.passed ? 'test-passed' : 'test-failed';
                        const testIcon = test.passed ? 'âœ…' : 'âŒ';
                        html += `
                            <div class="test-result ${testClass}">
                                ${testIcon} ${test.name}
                                ${test.error ? `<br><small>é”™è¯¯: ${test.error}</small>` : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                });
                
                const overallPassed = results.every(result => result.overallPassed);
                const summaryClass = overallPassed ? 'success' : 'error';
                const summaryIcon = overallPassed ? 'ğŸ‰' : 'âš ï¸';
                
                html += `
                    <div class="${summaryClass}">
                        <h3>${summaryIcon} æ€»ä½“ç»“æœ</h3>
                        <p>${overallPassed ? 'æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Storeæ¶æ„å·¥ä½œæ­£å¸¸ã€‚' : 'éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ç›¸å…³åŠŸèƒ½ã€‚'}</p>
                    </div>
                `;
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                    </div>
                `;
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸš€ è¿è¡ŒStoreéªŒè¯æµ‹è¯•';
            }
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('runTest').addEventListener('click', runTests);
        
        // é¡µé¢åŠ è½½æ—¶å°è¯•åŠ è½½stores
        loadStores();
    </script>
</body>
</html>
